<!DOCTYPE html>
<html>
<head>
    <title> LastðŸ˜¤DB Bridge Storage</title>
    <style>
        body { font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #353a40; color: white; }
        #sync-btn { padding: 10px 20px; background: #28a745; border: none; color: white; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <button id="sync-btn">Sync Global Database</button>

    <script>
        const DB_NAME = 'DomainStatusDB';
        const STORE_NAME = 'entries';
        let db = null;

        const initDB = () => {
            const request = indexedDB.open(DB_NAME, 1);
            request.onupgradeneeded = (e) => {
                const database = e.target.result;
                if (!database.objectStoreNames.contains(STORE_NAME)) {
                    database.createObjectStore(STORE_NAME, { keyPath: 'id' });
                }
            };
            request.onsuccess = (e) => {
                db = e.target.result;
                window.parent.postMessage({ type: 'BRIDGE_READY' }, "*");
            };
        };

        // THE KEY FIX: Requesting Storage Access
        document.getElementById('sync-btn').onclick = async () => {
            try {
                if (document.requestStorageAccess) {
                    await document.requestStorageAccess();
                    console.log("Storage Access Granted!");
                    initDB(); // Initialize DB after access is granted
                } else {
                    initDB(); // Fallback for browsers that don't support the API yet
                }
            } catch (err) {
                console.error("Access denied:", err);
            }
        };
    </script>
</body>
</html>
